### 定义
发布订阅模式又称观察者模式,它定义了对象间的一种一对多的依赖关系，
当一个对象的状态发生改变时，所有依赖它的对象都将得到通知。

JavaScript开发中，我们一般用事件模型来替代传统的发布—订阅模式(它们本质是一样的)。

### 作用
1. 用于异步编程，这样则不用关注对象在异步运行期间的状态
2. 取代对象之间硬编码的通知机制，让对象松耦合的联系在一起

### dom事件实质为订阅-发布

```javascript
// 订阅点击事件
document.body.addEventListener('click',one) // 添加事件1
document.body.addEventListener('click',two) // 添加事件2
function one(){}
function two(){}
//  移除订阅
document.body.removeEventListener('click',one) 
```

### code实现订阅发布

#### 第一版
1. 先确定发布者
2. 发布者需要一个缓存队列，用于存储回调函数以便通知订阅者
3. 发布者需要发布消息的方法，新增订阅者的方法，删除订阅的方法
```javascript
var Public = {} // 发布者
Public.subscriber = [] // 存放订阅者的回调，实质就是订阅者
Public.listen = function(fn){  // 新增订阅消息
  this.subscriber.push(fn) // 现在不管订阅什么，都往里面放
}
Public.trigger = function(){
  for(var i =0,fn; fn = this.subscriber[i++];){
    fn.apply(this,arguments)
  }
}
```
#### 第二版
第一版中，当发布信息的时候，Public.subscriber中所有的订阅者都会收到发布的信息

但是，实际上是订阅了才通知，不订阅则不通知，因此，需要给回调函数(订阅者)添加一个key去标识
```javascript
Public.subscriber = {}  // 采用对象的方式
Public.listen = function(key,fn){
  if(!this.subscriber[key]){
    this.subscriber[key] = []
  }
  this.subscriber[key].push(fn)
}
Public.trigger = function(){
  var key = Array.prototype.shift.call(arguments), // 发布消息时，取出订阅了该事件的订阅者(回调函数)
      fns = this.subscriber[key]
  if(!fns || fns.length === 0){
    return false
  }
  for(var i =0,fn;fn=fns[i++];){
    fn.apply(this,arguments)
  }
}
```

#### 第三版
添加取消订阅的方法
```javascript
Public.remove = function(key,fn){
  var fns = this.subscriber[key]
  if(!fns){
    return false
  }
  if(!fn){ // 不指定取消哪个订阅(哪个回调函数)，那么取消所有的订阅
    fns && (fns.length = 0)
  }else{
    for(var l = fns.length-1; l>=0;l--){
      var _fn = fns[l]
      if(_fn === fn){
        fns.splice(l,1)
      }
    }
  }
}
```

